semantics disjunctive;
module Process1:
  procnumber = 1;

  idlen = "idle" + procnumber;
  tryingn = "trying" + procnumber;
  waitingn = "waiting" + procnumber;
  criticaln = "critical" + procnumber;

  bloom(idlen);
  bloom(tryingn);
  bloom(waitingn);
  bloom(criticaln);

  mark_with(idlen, "initial");

  critprop = "critical" + procnumber;
  mark_with(criticaln, critprop);
  
  startnl = "Start" + procnumber;
  join_with(idlen, tryingn, startnl);

  setxl = "SetX" + procnumber;
  join_with(tryingn,  waitingn, setxl);

  enterl = "Enter" + procnumber;
  join_with(waitingn, criticaln, enterl);

  retxl = "SetX0" + procnumber;
  join_with(criticaln,  idlen, retxl);

module Process2:
  procnumber = 2;

  idlen = "idle" + procnumber;
  tryingn = "trying" + procnumber;
  waitingn = "waiting" + procnumber;
  criticaln = "critical" + procnumber;

  bloom(idlen);
  bloom(tryingn);
  bloom(waitingn);
  bloom(criticaln);

  mark_with(idlen, "initial");

  critprop = "critical" + procnumber;
  mark_with(criticaln, critprop);
  
  startnl = "Start" + procnumber;
  join_with(idlen, tryingn, startnl);

  setxl = "SetX" + procnumber;
  join_with(tryingn,  waitingn, setxl);

  enterl = "Enter" + procnumber;
  join_with(waitingn, criticaln, enterl);

  retxl = "SetX0" + procnumber;
  join_with(criticaln,  idlen, retxl);

module Process3:
  procnumber = 3;

  idlen = "idle" + procnumber;
  tryingn = "trying" + procnumber;
  waitingn = "waiting" + procnumber;
  criticaln = "critical" + procnumber;

  bloom(idlen);
  bloom(tryingn);
  bloom(waitingn);
  bloom(criticaln);

  mark_with(idlen, "initial");

  critprop = "critical" + procnumber;
  mark_with(criticaln, critprop);
  
  startnl = "Start" + procnumber;
  join_with(idlen, tryingn, startnl);

  setxl = "SetX" + procnumber;
  join_with(tryingn,  waitingn, setxl);

  enterl = "Enter" + procnumber;
  join_with(waitingn, criticaln, enterl);

  retxl = "SetX0" + procnumber;
  join_with(criticaln,  idlen, retxl);

module Process4:
  procnumber = 4;

  idlen = "idle" + procnumber;
  tryingn = "trying" + procnumber;
  waitingn = "waiting" + procnumber;
  criticaln = "critical" + procnumber;

  bloom(idlen);
  bloom(tryingn);
  bloom(waitingn);
  bloom(criticaln);

  mark_with(idlen, "initial");

  critprop = "critical" + procnumber;
  mark_with(criticaln, critprop);
  
  startnl = "Start" + procnumber;
  join_with(idlen, tryingn, startnl);

  setxl = "SetX" + procnumber;
  join_with(tryingn,  waitingn, setxl);

  enterl = "Enter" + procnumber;
  join_with(waitingn, criticaln, enterl);

  retxl = "SetX0" + procnumber;
  join_with(criticaln,  idlen, retxl);

module Process5:
  procnumber = 5;

  idlen = "idle" + procnumber;
  tryingn = "trying" + procnumber;
  waitingn = "waiting" + procnumber;
  criticaln = "critical" + procnumber;

  bloom(idlen);
  bloom(tryingn);
  bloom(waitingn);
  bloom(criticaln);

  mark_with(idlen, "initial");

  critprop = "critical" + procnumber;
  mark_with(criticaln, critprop);
  
  startnl = "Start" + procnumber;
  join_with(idlen, tryingn, startnl);

  setxl = "SetX" + procnumber;
  join_with(tryingn,  waitingn, setxl);

  enterl = "Enter" + procnumber;
  join_with(waitingn, criticaln, enterl);

  retxl = "SetX0" + procnumber;
  join_with(criticaln,  idlen, retxl);

module Process6:
  procnumber = 6;

  idlen = "idle" + procnumber;
  tryingn = "trying" + procnumber;
  waitingn = "waiting" + procnumber;
  criticaln = "critical" + procnumber;

  bloom(idlen);
  bloom(tryingn);
  bloom(waitingn);
  bloom(criticaln);

  mark_with(idlen, "initial");

  critprop = "critical" + procnumber;
  mark_with(criticaln, critprop);
  
  startnl = "Start" + procnumber;
  join_with(idlen, tryingn, startnl);

  setxl = "SetX" + procnumber;
  join_with(tryingn,  waitingn, setxl);

  enterl = "Enter" + procnumber;
  join_with(waitingn, criticaln, enterl);

  retxl = "SetX0" + procnumber;
  join_with(criticaln,  idlen, retxl);

module Variable:
processes = 6;
  
  i = 0;
  while( i <= processes ) {
     valn = "Val" + i;
     bloom(valn);
     i = i+1;
  } 

  mark_with("Val0", "initial");

  i = 0;

  while( i <= processes ) {

       outv = "Val" + i;

       j = 0;    
       while( j <= processes ) {
         inv = "Val" + j;

         if( i == j ) {
	    if( i == 0 ) {
	     
	     k = 1;
	     while(k <= processes) {
	        startnl = "Start" + k;
	        join_with(outv, inv, startnl);
		k = k + 1;
		}
            } else {
	        setxl = "SetX" + i;	
                enterl = "Enter" + i; 
	        join_with(outv, inv, setxl);	      
	        join_with(outv, inv, enterl);	      
	    }   

	 } else {
		    if( j == 0 ) {
		      retxl = "SetX0" + i;
		      join_with(outv, inv, retxl);	      
		    } else {
		      setxl = "SetX" + j;
		      join_with(outv, inv, setxl);	      
		    }
         }


         j = j + 1;
       }

     i = i + 1;
  }

verify:
#EF($var; (
critical1 and critical2 and critical3
));
